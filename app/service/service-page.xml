<Page
    navigatingTo="onNavigatingTo"
    xmlns="http://schemas.nativescript.org/tns.xsd">

    <ActionBar>
        <NavigationButton visibility="hidden"></NavigationButton>
        <GridLayout columns="30,*" rows="auto,auto">
            <Label text="Service Details" colSpan="2" row="0" padding="0" />
            <Label text="{{ dateF(now, 'dd/MM/yyyy HH:mm:ss') }}" colSpan="2" row="1" fontSize="10" padding="0" />
            <Label class="fas" text="&#xf060;" tap="onBackButtonTap" col="0" rowSpan="2" />
        </GridLayout>
    </ActionBar>

    <GridLayout columns="auto,*" rows="auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto" class="page__content">
        <Label row="0" colSpan="2" class="{{ 'service-detail-title ' + (service.attrs.state == 0 ? 'service-ok' : 'service-critical' ) }}">
            <FormattedString>
                <Span text="{{ service.attrs.host_name }}" />
                <Span text=": " />
                <Span text="{{ service.attrs.display_name }}" />
            </FormattedString>
        </Label>
        <Label row="1" col="0" text="Hostname:" />
        <Label row="1" col="1" text="{{ service.attrs.host_name }}" />
        <Label row="2" col="0" text="IPv4:" />
        <Label row="2" col="1" text="{{ service.joins.host.address }}" />
        <Label row="3" col="0" text="Acknowledged:" />
        <Label row="3" col="1" text="{{ service.attrs.acknowledgement == 0 ? 'No' : 'Acknowledged' + (service.attrs.acknowledgement == 2 ? ' (Sticky)' : '') }}" />
        <StackLayout row="4" colSpan="2" orientation="horizontal">
            <Button text="{{ (service.attrs.acknowledgement != 0 ? 'Remove ' : '') + 'Ack' }}" isEnabled="{{ service.attrs.state != 0 }}" />
            <Button text="Check" tap="onCheckTap" />
            <Button text="Comment" />
            <Button text="Notify" />
        </StackLayout>
        <Label row="5" colSpan="2" class="service-detail-subtitle" text="Check Execution" />
        <Label row="6" col="0" text="Command:" />
        <Label row="6" col="1" text="{{ service.attrs.check_command }}" />
        <Label row="7" col="0" text="Source:" />
        <Label row="7" col="1" text="{{ service.attrs.last_check_result.check_source }}" />
        <Label row="8" col="0" text="Zone:" />
        <Label row="8" col="1" text="{{ service.attrs.zone }}" />
        <Label row="9" col="0" text="Next check:" />
        <Label row="9" col="1" text="{{ dateF(new Date(service.attrs.next_check * 1000), 'dd/MM/yyyy HH:mm:ss') }}" />
        <Label row="10" col="0" text="Check interval:" />
        <Label row="10" col="1" text="{{ dateFD(dateI2D({ start: new Date(0), end: new Date(service.attrs.check_interval * 1000) })) }}"/>
        <Label row="11" col="0" text="Reachable:" />
        <Label row="11" col="1" text="{{ service.attrs.last_reachable ? 'Yes' : 'No'  }}" />
        <Label row="12" col="0" text="Check attempts:" />
        <Label row="12" col="1" text="{{ service.attrs.check_attempt + '/' + service.attrs.max_check_attempts + ' (' + (service.attrs.state_type == 1 ? 'hard' : 'soft') + ' state)' }}" />
        <Label row="13" col="0" text="Execution time:" />
        <Label row="13" col="1" text="{{ dateFD(dateI2D({ start: new Date(0), end: new Date((service.attrs.last_check_result.execution_end - service.attrs.last_check_result.execution_start) * 1000) })) }}"/>
        <Label row="14" col="0" text="Flapping:" />
        <Label row="14" col="1" text="{{ service.attrs.flapping ? 'Yes' : 'No' }}" />
        <Label row="15" colSpan="2" class="service-detail-subtitle" text="Plugin Output" />
        <Label row="16" colSpan="2" text="{{ service.attrs.last_check_result.output }}" textWrap="true" />
        <Label row="17" colSpan="2" class="service-detail-subtitle" text="Comments" visibility="{{ comments.length > 0 ? 'visible' : 'hidden' }}" />
        <ListView row="18" colSpan="2" items="{{ comments }}" width="100%">
            <ListView.itemTemplate>
                <Label textWrap="true">
                    <FormattedString>
                        <Span text="{{ dateF(new Date(attrs.entry_time * 1000), 'dd/MM/yyyy HH:mm:ss') }}" fontWeight="bold" />
                        <Span text=" (ack: " fontWeight="bold" />
                        <Span text="{{ attrs.author }}" fontWeight="bold" />
                        <Span text="): " fontWeight="bold" />
                        <Span text="{{ attrs.text }}" />
                    </FormattedString>
                </Label>
            </ListView.itemTemplate>
        </ListView>
    </GridLayout>
</Page>
